{{ define "content" }}
<div class="col-lg-6 col-12 content-container-large pb-4">
    <div class="header-container-large d-flex justify-content-between">
      <h1 class="page-title">{{ .title }}</h1>
    </div>
    <form class="form-device">
        <div class="mb-3">
          <label for="device_name" class="form-label">Nama Perangkat</label>
          <input type="text" class="form-control" id="device_name" name="device_name" placeholder="Masukkan Nama Perangkat">
        </div>
        <div class="mb-3">
            <label for="antares_id" class="form-label">Antares ID</label>
            <input type="text" class="form-control" id="antares_id" name="antares_id" placeholder="Masukkan Antares Id Perangkat">
        </div>
        <div class="mb-3">
            <label for="device_location" class="form-label">Lokasi Perangkat</label>
            <textarea type="textarea" class="form-control" id="device_location" name="device_location" placeholder="Masukkan Detail Lokasi Device"></textarea>
        </div>
        <div class="mb-3">
            <label for="koor_loc" class="form-label">Koordinat Lokasi</label>
            <select class="form-select form-control" aria-label="Default select example" id="koor_loc" name="koor_loc">
                <option disabled selected>Pilih Metode</option>
                <option value="input-loc-manual">Input Manual</option>
                <option value="curr-loc">Lokasi Terkini</option>
                <option value="pin-from-maps">Pin Maps</option>
            </select>
            <div id="wrapper-map" class="mt-3"></div>
        </div>
        <div class="manual-loc-form">
            <div class="mb-3">
                <label for="latitude" class="form-label">Latitude</label>
                <input type="text" class="form-control" id="latitude" name="latitude" placeholder="Masukkan Latitude">
            </div>
            <div class="mb-3">
                <label for="longitude" class="form-label">Longitude</label>
                <input type="text" class="form-control" id="longitude" name="longitude" placeholder="Masukkan longitude">
            </div>
        </div>
        <div class="mb-3">
            <label for="brand" class="form-label">Aerator Brand</label>
            <select class="form-select form-control" aria-label="Default select example" id="brand" name="brand">
                <option disabled selected>Pilih Merek Perangkat</option>
                <option value="Amara 2 Lubang">Amara 2 Lubang</option>
            </select>
        </div>
        <div class="mb-3">
            <label for="mode_id" class="form-label">Model Awal</label>
            <select class="form-select form-control" aria-label="Default select example" id="mode_id" name="mode_id">
                <option disabled selected>Pilih Mode</option>
                <option value="1">Manual</option>
                <option value="2">Otomatis</option>
            </select>
        </div>
        <button type="submit" class="btn btn-guppytech w-50 mt-3">Tambah</button>
    </form>
</div>
<style>
    .form-device .form-control{
        font-size: 14px;
    }
    .leaflet-popup.leaflet-zoom-animated{
        bottom: 35px !important;
    }
    .manual-loc-form{
        display: none;
    }
</style>
<script>
    $('#koor_loc').on('change', function() {
        if ( this.value == 'curr-loc') {
            $('.manual-loc-form').css('display','none');
            $('#map').css('display','block');
            getLocation();
        } 
        else if (this.value == 'input-loc-manual'){
            $('#map').css('display','none');
            $('.manual-loc-form').css('display','block');
        }
        else if (this.value == 'pin-from-maps'){
            $('#map').css('display','block');
            $('.manual-loc-form').css('display','none');
            
            leafletMap(-6.901779067052239, 107.61896902369566, 12);
        }
    });

    x = document.getElementById("map");
    function getLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showPosition);
        } else { 
            x.innerHTML = "Geolocation is not supported by this browser.";
        }
    }

    function showPosition(position) {
        leafletMap(position.coords.latitude, position.coords.longitude,18);
    }

    function leafletMap(latitude,longitude,zoomView){
        document.getElementById('wrapper-map').innerHTML = "<div id='map' style='width: 100%; height: 400px; border-radius:10px'></div>";
        const map = L.map('map').setView([latitude, longitude], zoomView);
        const tiles = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        var popup = L.popup();

        var theMarker = {};
        theMarker = L.marker([latitude,longitude]).addTo(map);

        selected_koor = document.getElementById('selected-koor');
        function onMapClick(e) {
            popup
                .setLatLng(e.latlng)
                .setContent(e.latlng.lat + "," + e.latlng.lng)
                .openOn(map);

            if (theMarker != undefined) {
                map.removeLayer(theMarker);
            };
            theMarker = L.marker([e.latlng.lat, e.latlng.lng]).addTo(map);
        }
        map.on('click', onMapClick);
    }
</script>
{{ end }}